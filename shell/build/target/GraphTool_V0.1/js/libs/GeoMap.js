define("GeoMap",["zrender","zrender/shape/Base","zrender/shape/Polygon","zrender/shape/BrokenLine","zrender/tool/util","zrender/shape/Text","zrender/shape/Image","zrender/shape/Rectangle","zrender/tool/area"],function(t,e,a,r,n,o,i,s,l){function h(){var t=this,e=t.toDataURL({bgcolor:"rgba(0,0,0,0)"}),a=t._data,r=t.mirror;r.attr("src",e).css({left:0,top:0,"transform-origin":a.width/2+"px "+a.height/2+"px",transform:"scale(1)"}).show(),$(t.conf.container).addClass("mirror")}function c(t,e){e&&(e.zlevel=x);var a=[],r=this,n=!e.is_lnglat,o=e.scale||1;return $.each(t,function(t,i){var s=[];$.each(i,function(t,e){s.push(new C.Point(e[0]/o,e[1]/o,n))});var l=new C.Polygon(s,e);l.points=s,a.push(l),r.addOverlay(l,200*Math.random())}),a}function p(t,e,a){y.start("render geo");var r=this,n=t.shift();$.each(t,function(t,e){n.features=n.features.concat(e.features);var a=n.srcSize,r=e.srcSize,o=a.left,i=a.top,s=a.width,l=a.height,h=r.left,c=r.top,p=r.width,d=r.height,f={left:Math.min(o,h),top:Math.max(i,c)},v=Math.max(o+s,h+p),u=Math.min(i+l,c+d);f.width=v-f.left,f.height=f.top-u,n.srcSize=f});var o=[],i=!n.projector,s=n.scale;$.each(n.features,function(t,e){var a=e.type;if("Feature"==a){var n=e.geometry,l=n.type,h={enname:e.id,properties:e.properties,style:{text:e.properties.name},zlevel:x,is_lnglat:i,scale:s};"Polygon"==l?o.push(c.call(r,n.coordinates,h)):"MultiPolygon"==l?$.each(n.coordinates,function(t,e){t>0&&delete h.style.text,o.push(c.call(r,e,h))}):g.log(e,l)}}),y.end("render geo");var l=[];$.each(o,function(t,e){$.each(e,function(t,e){l.push(e.shape.style.pointList)})}),r.addMask(l,$.extend(!0,{is_lnglat:!1},e)),$.isFunction(a)&&a(l)}function d(t){var e=this.polygons;$.isArray(e)&&(t.save(),t.beginPath(),$.each(e,function(e,a){if(!(a.length<2)){t.moveTo(a[0][0],a[0][1]);for(var r=1,n=a.length;n>r;r++)t.lineTo(a[r][0],a[r][1]);t.lineTo(a[0][0],a[0][1])}}),t.closePath(),t.clip())}function f(t,e,a){var r=document.createElement(e),n=a._width,o=a._height;return r.style.position="absolute",r.style.left=0,r.style.top=0,r.style.width=n+"px",r.style.height=o+"px",r.setAttribute("width",n*w),r.setAttribute("height",o*w),r}function v(t,e){e.invisible||(!e.onbrush||e.onbrush&&!e.onbrush(t,!1))&&e.brush(t,!1,self.updatePainter)}function u(t){var e=this.points,a=[];$.each(e,function(e,r){var n=D.call(t,r);a.push([n.x,n.y])}),this.shape.style.pointList=a}var g=Core.util.Logger,y=g.Timer,x=2,m=1,M=0,w=window.devicePixelRatio||1;w=Math.max(w,1);var _=Math.PI/180,P=180/Math.PI,b=38e5,T=function(){var t=20037508.34/180,e={};return{name:"mercator",project:function(a){var r=a.x,n=a.y,o=r+"_"+n,i=e[o];if(i)return i;var s=r*t,l=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);l*=t;var h={x:s/b,y:l/b};return e[o]=h,h},invert:function(e){var a=e.x/t,r=e.y/t;return r=180/Math.PI*(2*Math.atan(Math.exp(r*Math.PI/180))-Math.PI/2),{x:a*b,y:r*b}}}}(),z=function(){function t(t,a,r,n){void 0==t&&(t=23),void 0==a&&(a=-96),void 0==r&&(r=29.5),void 0==n&&(n=45.5),t=e.radians(t),a=e.radians(a),r=e.radians(r),n=e.radians(n);var o=.5*(Math.sin(r)+Math.sin(n)),i=Math.cos(r),s=i*i+2*o*Math.sin(r),l=Math.sqrt(s-2*o*Math.sin(t))/o;return{name:"albers",project:function(t){var r=o*(e.radians(t.x)-a),n=Math.sqrt(s-2*o*Math.sin(e.radians(t.y)))/o,i={x:n*Math.sin(r)/b,y:l-n*Math.cos(r)/b};return i},invert:function(t){var a=Math.atan(t.x/(l-t.y)),r=Math.sqrt(t.x*t.y+Math.pow(l-t.y,2));return{lng:e.degrees(lon0+a/o),lat:e.degrees(Math.asin((s-r*r*o*o)/(2*o)))}}}}var e={};return e.radians=function(t){return _*t},e.degrees=function(t){return P*t},t(35,105,27,45)}(),I={height:35.4638,left:73.4766,top:53.5693,width:61.6113},k={container:"body"},L=function(){var t=this,e=t.conf,a=$(e.container),r=a.width(),n=a.height(),o=t.projector.project({x:I.left,y:I.top}),i=t.projector.project({x:I.left+I.width,y:I.top-I.height}),s={width:i.x-o.x,height:o.y-i.y},l=r/s.width,h=n/s.height,c=e.center||{x:I.left+I.width/2,y:I.top-I.height/2},p=t.projector.project(c),d=r/800;t._data={scale:Math.min(l,h),zoom:1,center:{lng:c.x,lat:c.y,x:p.x,y:p.y},translat:[r/2,n/2],width:r,height:n,overlays:[]},t._data_o=$.extend(!0,{},t._data),t.MAX_ZOOM=3*d,t.MIN_ZOOM=.5*d,e.mirror&&(t.mirror=$('<img class="geomap_mirror" draggable=false>').appendTo(a.parent()))},C=function(e){var a=this;a.projector="mercator"==e.projector?T:z,a.conf=e=$.extend({},k,e),a.canvas=t.init($(e.container).get(0)),a.jsonLoader=e.jsonLoader||$.getJSON,L.call(a)};C.PROJECT_MERCATOR="mercator",C.PROJECT_ALBERS="albers",C.ZLEVEL={MAP:x,LAYER:m,NOCLIP:M};var O=C.prototype;O.draggable=function(t){var e=this,a=e._data,r=$(this.mirror),n=.3,o=a.width*n,i=a.height*n,s=$.extend({disabled:!1,containment:[-o+300,-i,o+300,i],stop:function(){A.call(e,R)}},t);r.draggable(s)},O.zoom=function(t,e){if(1!=t&&t>0){var a=this,r=a._data.zoom,n=$(a.mirror);t*=r,t>=a.MIN_ZOOM&&t<=a.MAX_ZOOM&&(a._data.zoom=t,n.css({"transform-origin":e.x+"px "+e.y+"px",transform:"scale("+t+")"}),A.call(a,S))}},O.reset=function(){A.call(this,j)},O.reset_drag=function(){A.call(this,R)},O.reset_zoom=function(){A.call(this,S)};var S=1,R=2,j=3,A=function(e){var a=this,r=a.canvas,n=a._data,o=(n.width,n.height,$(a.mirror)),i=n.overlays;if(j==e){var s=a._data_o;n=$.extend(!0,{},s),n.overlays=i,a._data=n}else{var l=n.zoom,c=l-1,p=o.position(),d=o.data("pos_o_drag")||{left:0,top:0},f=o.data("origin_o"),v=f&&R==e?f:o.css("transform-origin"),u=v.split(/\s+/),g=parseFloat(u[0]),y=parseFloat(u[1]),m=translat_y=0;if(R==e){var M=p.left+d.left,w=p.top+d.top;m=M-g*c,translat_y=w-y*c,o.data("pos_o_drag",{left:M,top:w})}else m=p.left,translat_y=p.top,o.data("origin_o",v);n.translat=[n.width/2*l+m,n.height/2*l+translat_y]}var _=$(a.conf.container),P=[],b=[];r.dispose(),r=a.canvas=t.init(_.get(0)),$.each(i,function(t,e){var n=e.draw(a);n.zlevel==x?(P.push(n.style.pointList),r.addShape(n)):b.push(n)}),gm.addMask(P,{is_lnglat:!1}),$.each(b,function(t,e){r.addShape(e)}),r.render(),h.call(a)};O.loadGeo=function(t,e,a){var r=this;$.isArray(t)||(t=[t]);var n=[],o=t.length;y.start("loadGeo"),$.each(t,function(t,i){r.jsonLoader(i,function(t){if(n.push(t),n.length==o){y.end("loadGeo"),y.start("add weather layers"),p.call(r,n,e,a),y.end("add weather layers"),y.start("init mirror"),h.call(r),y.end("init mirror");var i=r.conf.onInitedLayers;i&&i()}})})},O.addOverlay=function(t,e){var a=this,r=t.draw(this);return a._data.overlays.push(t),e||(e=0),a.canvas.addShape(r),a.canvas.render(),r},O.clearLayers=function(){for(var t,e=this,a=e.canvas,r=e._data.overlays,n=[];t=r.shift();){var o=t.shape;o.zlevel!=x?a.delShape(o.id):n.push(t)}a.refresh(),e._data.overlays=n,this.refresh()},O.refresh=function(){h.call(this)};var D=O.pointToOverlayPixel=function(t){var e=t.is_lnglat;t={x:t.lng,y:t.lat},e&&(t=this.projector.project(t));var a=this,r=a._data,n=r.center,o=r.scale,i=(r.width,r.height,r.zoom),s=r.translat;return{x:(t.x-n.x)*o*i+s[0],y:(n.y-t.y)*o*i+s[1]}};O.addMask=function(t){if(t?this.polygons=t:t=this.polygons,t){var e=this.canvas.painter.getLayer(m).ctx;d.call(this,e)}};{var E=Core.Color;E.toRGB,E.toHTML}O.toDataURL=function(t){var e=this,a=e.canvas.painter,r=a._width,n=a._height,o=f("mask-image","canvas",a),i=o.getContext("2d");1!=w&&i.scale(w,w),d.call(e,i);var s=e.canvas.storage.getShapeList(),l=[];$.each(s,function(t,e){e.zlevel==m?v(i,e):l.push(e)});var h=o.toDataURL();if(o=f("mask-image","canvas",a),i=o.getContext("2d"),1!=w&&i.scale(w,w),t){var c=t.bgimg;if(c)i.drawImage(c,0,0);else{var p=t.bgcolor||"#ffffff";i.fillStyle=p,i.fillRect(0,0,r,n)}}var u=new Image;u.src=h,i.drawImage(u,0,0),$.each(l,function(t,e){v(i,e)});var g=o.toDataURL(null,p);return o=null,i=null,g};var F=function(t){o.call(this,t)};F.prototype={type:"gmtext",brush:function(t,e){var a=this.style,r=a.backgroundColor,n=this.getRect(a),i=n.x,s=n.y,h=n.width,c=n.height,p=l.getTextHeight("å›½",a.textFont);if(t.save(),r){t.fillStyle=r;var d=h,f=Math.max(c,p),v=a.padding;v&&(d+=v[1]+v[3],f+=v[0]+v[2]),f+=3,t.fillRect(i,s,d,f)}var u=a.textDecoration;if(u){var g=p/30;if(t.lineWidth=.5*g,t.strokeStyle=a.color,u.indexOf("underline")>-1){var f=s+c+2*g;t.moveTo(i,f),t.lineTo(i+h,f)}if(t.stroke(),u.indexOf("line-through")>-1){var f=s+c/2+3*g;t.moveTo(i,f),t.lineTo(i+h,f)}t.stroke()}t.restore(),o.prototype.brush.call(this,t,e)}},n.inherits(F,o);var N=function(t,e){r.call(this,t),this.special_options=e};N.prototype={type:"gmpolyline",brush:function(t,e){var a=this;r.prototype.brush.call(a,t,e);var n=a.special_options,o=n.code;if(o&&2==o||3==o||38==o){var i=n.width,s=n.space_point,l=Math.pow(i,2),h=a.style,c=h.pointList,p=h.color||h.strokeColor;t.save(),t.fillStyle=p,t.strokeStyle=p;var d,f,v=[];if(c[0][0]>c[c.length-1][0]&&c.reverse(),38==o){for(var u=s,g=c.length;g>u;u+=s){var y=c[u],x=c[u+1];if(y&&x){var m=y[0],M=y[1],w=x[0],_=x[1];if(m!=w){var P=Math.atan((_-M)/(w-m))+Math.PI;w>m&&(P+=Math.PI);var b=m+(w-m)/2,T=M+(_-M)/2,$=T-i*Math.cos(P),z=b+i*Math.sin(P);t.moveTo(b,T),t.lineTo(z,$),t.stroke()}}}return}for(var u=s,g=c.length;g>u;u++){var I=c[u];if(d){var k=Math.pow(I[0]-d[0],2)+Math.pow(I[1]-d[1],2);if(k>=l)if(k==l)f=I;else if(v.length>0){var L=v[v.length-1],m=L[0],M=L[1],w=I[0],_=I[1],C=d[0],O=d[1];if(m==w){var z=m,$=Math.sqrt(l-Math.pow(C-z,2)),S=Math.min(M,_),R=Math.max(M,_);f=$>=S&&R>=$?[z,$]:[z,-$]}else{var j=(M-_)/(m-w),A=(m*_-w*M)/(m-w),D=1+j*j,E=2*j*A-2*C-2*j*O,F=C*C+O*O+A*A-2*A*O-l,N=-E/(2*D),q=Math.sqrt(E*E-4*D*F)/(2*D);if(q){var B=Math.min(m,w),G=Math.max(m,w),z=N+q;(B>z||z>G)&&(z=N-q),f=[z,j*z+A]}else v.push(I)}}else{var m=d[0],M=d[1],w=I[0],_=I[1];if(m==w)f=[m,M+i];else{var P=Math.atan((_-M)/(w-m));f=[m-i*Math.sin(P),M-Math.cos(P)]}}else v.push(I);if(d&&f){t.beginPath(),t.moveTo(d[0],d[1]);for(var Z=0,U=v.length;U>Z;Z++){var I=v[Z];t.lineTo(I[0],I[1])}var m=d[0],M=d[1],w=f[0],_=f[1];if(2==o){if(m==w)var W=[m-i,M+(_-M)/2];else{var P=-Math.atan((_-M)/(w-m)),J=i*Math.sin(Math.PI/4);P=Math.PI/4-P;var z=m+J*Math.cos(P),$=M+J*Math.sin(P),W=[z,$]}t.lineTo(W[0],W[1])}else if(3==o){var P=w==m?0:Math.atan((_-M)/(w-m));t.arc(m+(w-m)/2,M+(_-M)/2,i/2,P,P+Math.PI,!0)}t.closePath(),t.fill(),d=f=null,v=[],u+=s}}else d=I}t.restore()}}},n.inherits(N,r),C.Point=function(t,e,a){this.lng=t,this.lat=e,this.is_lnglat=!a},C.Polygon=function(t,e){this.points=t,this.shape=new a($.extend(!0,{style:{brushType:"both",lineWidth:1,strokeColor:"#3D534E",color:"rgba(0,0,0,0)",textColor:"black",textFont:'12px "Microsoft Yahei"',textPosition:"inside"},zlevel:m,needTransform:!0,needLocalTransform:!0,hoverable:!1},e))},C.Polygon.prototype.draw=function(t){return u.call(this,t),this.shape},C.Polyline=function(t,e,a){this.points=t,this.shape=new N($.extend(!0,{style:{brushType:"both",lineWidth:1,strokeColor:"red"},zlevel:m,needTransform:!0,needLocalTransform:!0,hoverable:!1},e),$.extend({width:20,space_point:10},a))},C.Polyline.prototype.draw=function(t){return u.call(this,t),this.shape},C.Text=function(t,e,a,r){a||(a=[0,0,0,0]);var n={};e&&$.each(e.split(";"),function(t,e){var a=e.split(":");2==a.length&&(n[a[0].trim()]=a[1].trim())});var o={text:t,brushType:"fill",textAlign:"left",textBaseline:"top"},i=n.left,s=n.top;i&&(o.x=parseFloat(i)),s&&(o.y=parseFloat(s));var l=n.color;l&&(o.color=l,o.strokeColor=l);var h="",c=n["font-style"];c&&(h+=" "+c);var p=n["font-weight"];p&&(h+=" "+p);var d=n["font-size"];d&&(h+=" "+d),h+=' "Microsoft Yahei"',h&&(o.textFont=h);var f=n["background-color"];f&&"transparent"!=f&&(o.backgroundColor=f),o.padding=a;var v=n["text-decoration"];v&&(o.textDecoration=v),this.shape=new F({style:o,zlevel:m}),this.shape._option=r},C.Text.prototype.draw=function(t){var e=this.shape,a=e._option;if(a&&(isNaN(a.zlevel)||(e.zlevel=a.zlevel),a.pos))try{var r=t.pointToOverlayPixel(new C.Point(a.pos.x,a.pos.y));e.style.x=r.x,e.style.y=r.y}catch(n){}return e},C.Image=function(t,e,a,r,n){var o={image:t,x:e||0,y:a||0};r&&(o.width=r),n&&(o.height=n),this.shape=new i({style:o,zlevel:m})},C.Image.prototype.draw=function(){return this.shape},C.Rectangle=function(t){this.shape=new s($.extend(t,{zlevel:m}))},C.Rectangle.prototype.draw=function(){return this.shape};var q=function(){e.call(this,{zlevel:m})};return q.prototype={type:"mask",setData:function(t,e,a){var r=this;r.interpolationArr=t,r.c_width=e,r.c_height=a},brush:function(t){function e(t,e){try{var a=o[t][e];if(a)return a}catch(r){}return{x:s+t*c,y:l+e*p,color:[0,0,0,0]}}var a,r,n=this,o=n.interpolationArr;try{a=o.length,r=o[0].length}catch(i){}if(a>0&&r>0){var s=o[0][0].x,l=o[0][0].y,h=o[a-1][r-1],c=(h.x,h.y,o[0][1].x-s),p=o[1][0].y-l,v=n.c_width,u=n.c_height,g=f("interpolation-image","canvas",{_width:v,_height:u}),y=g.getContext("2d");1!=w&&y.scale(w,w);for(var x=y.createImageData(v,u),m=(x.data,0);a>m;m++)for(var M=0;r>M;M++){var _=e(m,M),P=_.color;y.fillStyle="rgba("+P[0]+", "+P[1]+", "+P[2]+", "+P[3]+")",y.beginPath(),y.arc(_.x,_.y,1,0,2*Math.PI,1),y.closePath(),y.fill()}d.call(n.gm,t),t.drawImage(g,0,0),t.restore()}}},n.inherits(q,e),C.Interpolation=function(t){var e,a,r=this;try{e=t.length,a=t[0].length;var n=t[0][0],o=t[e-1][a-1];r.data={x0:n.x,y0:n.y,x1:o.x,y1:o.y,width:e,height:a,items:t}}catch(i){r.data={}}this.shape=new q},C.Interpolation.prototype.draw=function(t){for(var e=this,a=t._data,r=a.width,n=a.height,o=e.data,i=o.width,s=o.height,l=o.items,h=e.shape,c=t.pointToOverlayPixel(new C.Point(o.x0,o.y0)),p=t.pointToOverlayPixel(new C.Point(o.x1,o.y1)),d=((p.x-c.x)/(i-1),(c.y-p.y)/(s-1),[]),f=0;i>f;f++){for(var v=l[f],u=[],g=0;s>g;g++){var y=v[g],x=t.pointToOverlayPixel(new C.Point(y.x,y.y)),m=x.x,M=x.y;u.push({lng:y.x,lat:y.y,x:m,y:M,color:y.c})}d.push(u)}return h.setData(d,r,n),h.gm=t,h},C.Pattern={},C.Pattern.Streak=function(t){t=$.extend({fillColor:"white",lineCap:"butt",strokeStyle:"green",repeat:"repeat",space:2},t);var e=3*t.space;e%2>0&&(e+=1);var a=e/2,r=document.createElement("canvas");r.setAttribute("width",e),r.setAttribute("height",e);var n=r.getContext("2d");n.fillStyle=t.fillColor,n.fillRect(0,0,e,e),n.beginPath(),n.moveTo(0,a),n.lineTo(a,0),n.moveTo(a,e),n.lineTo(e,a),n.lineWidth=1,n.lineCap=t.lineCap,n.strokeStyle=t.strokeStyle,n.stroke(),n.closePath();var o=n.createPattern(r,t.repeat);return o},C});