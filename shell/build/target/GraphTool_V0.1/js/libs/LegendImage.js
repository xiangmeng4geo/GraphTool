define("LegendImage",["zrender","zrender/shape/Text","zrender/shape/Rectangle"],function(e,t,i){function n(n,a){var d=(a.util,a.is_show_unit,a.is_show_legend,a.is_reverse),o=a.is_updown,s=a.blendent,l=$("<div></div>");l.addClass(o?"legend_portrait":"legend_landscape");var p="",h=s.length,c="";$.each(s,function(e,t){var i=t.is_stripe||!1,n=t.val.n;c+="<span>"+n+"</span>",p+="<ul>";var r=t.colors;r=r.filter(function(e,t){return e.is_checked?(e._i=t,e):void 0}),r.sort(function(e,t){return e.order-t.order||e._i-t._i}),d&&r.reverse();var a=r.length;$.each(r,function(e,t){var n=o?"":"width: "+1/a*100+"%;",r=o?"":'style="color: '+t.color_text+'"';p+='<li style="'+n+'"><div style="background-color: '+t.color+';" data-stripe='+i+"></div><span "+r+">"+t.text+"</span></li>"}),p+="</ul>"});var v="";if(h>1&&o&&(v+="<div>"+c+"</div>"),v+=p,l.html(v),l.appendTo(r),o){var u=l.find("ul");l.find(">div span").each(function(e){$(this).width(u.eq(e).width())})}var f=$('<div style="width: '+l.width()+"px;height: "+l.height()+'px"></div>').appendTo(r).get(0),g=e.init(f);l.find("li div").each(function(){var e=$(this),t=e.data("stripe"),n=e.css("background-color");t&&(n=new GeoMap.Pattern.Streak({strokeStyle:n,space:1}));var r=$(this).position(),a={x:r.left+1,y:r.top+1,width:e.width()-2,height:e.height()-2,brushType:"both",color:n};g.addShape(new i({style:a})),g.render()}),l.find("span").each(function(){var e=$(this),i={text:e.text(),brushType:"fill",textAlign:"left",textBaseline:"top",lineWidth:3,color:$(this).css("color"),textFont:e.css("font")},n=e.position();i.x=n.left,i.y=n.top,o||e.parent().is("li")&&(i.x+=parseFloat(e.width())/2,i.y+=(parseFloat(e.css("margin-top"))||0)/2,i.textAlign="center",i.textBaseline="middle"),g.addShape(new t({style:i})),g.render()});var _=g.toDataURL(null,"rgba(0,0,0,0)");Core.Lib.util.file.tmp.legend.save(n,_),r.empty()}var r=$('<div class="legend_tmp"></div>').appendTo("#geomap_container");return n});