function formatDir(t,e){fs.readdir(t,function(r,n){return r?console.log(r):void n.forEach(function(r){var n=path.join(t,r);fs.stat(n,function(t,r){t?console.log(t):r.isDirectory()?formatDir(n,e):formatFile(n,function(t,r){t?console.log(t):saveData(r,e(n))})})})})}function saveData(t,e){"string"!=typeof t&&(t=JSON.stringify(t)),mkdirSync(path.dirname(e)),fs.writeFile(e,t,function(t){return t?console.log(t):void console.log(e,"save successfully!")})}function formatFile(t,e,r){"[object Function]"=={}.toString.call(e)&&(r=e,e=null),fs.readFile(t,{encoding:"utf8"},function(n,i){if(n)r&&r(n);else{var o=i.toString().split(/[\r\n]+/).filter(function(t){return!!t.trim()});if(o.length>0){var a,s=/diamond\s+(\d+)/.exec(o[0]);if(s&&(a=s[1])){var c;try{c=require("./types/"+a)}catch(f){return void(r&&r(ERROR_NOT_SUPPORT))}var i=c.parse(o.slice(2),e);i.type=a;var l=fs.statSync(t),m=new Date(l.mtime);if(i.mtime=m.getTime(),s=/^(([12]\d)?\d{2})\s+(\d{1,2})\s+(\d{1,2})\s+(\d{1,2})/.exec(o[1].trim())){var u=m.getFullYear(),d=s[3],g=s[4],p=s[5],R=path.basename(t).replace(/\..+/g,"").replace(/\D+$/,"").substr(-2);2!=R.length||isNaN(R)||(p=parseInt(R)),i.time=new Date(u+"-"+d+"-"+g+" "+p+":00").getTime()}return void(r&&r(null,i))}r&&r(ERROR_NO_TYPE)}else r&&r(ERROR_NO_DATA)}})}var fs=require("fs"),path=require("path"),mkdirSync=function(t){var e=path.dirname(t);fs.existsSync(e)||mkdirSync(e),fs.existsSync(t)||fs.mkdirSync(t)},ERROR_NO_DATA={code:1,msg:"no data"},ERROR_NO_TYPE={code:2,msg:"no data TYPE"},ERROR_NOT_SUPPORT={code:3,msg:"no support this type"},format=function(t,e){t=path.normalize(t),fs.stat(t,function(r,n){r?console.log(r):n.isDirectory()?formatDir(t,e):formatFile(t,function(r,n){r?console.log(r):saveData(n,e(t))})})};exports.parse=formatFile,exports.format=format;