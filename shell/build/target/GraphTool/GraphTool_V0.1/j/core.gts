!function(t){function n(e){var t=a.open("./"+e+".gt",$.extend({},g,s.get("view_"+e)));return t.on("close",function(){t.emit("beforeclose"),t.removeAllListeners(),this.close(!0)}),t}var r=t.require,o=this.global.require.extensions;o[".gts"]=o[".js"];var i={};i.require=r,i.Lib=r("core");var s=i.Lib.conf,c=nwDispatcher.requireNwGui(),a=c.Window,u=a.get();u.focus(),!function(){function e(e){return e.match(r)[0]}function t(e){for(e=e.replace(o,"/");e.match(s);)e=e.replace(s,"/");return e}function n(n,r){var o,i=n.charAt(0);if(c.test(n))o=n;else if("."===i)o=t((r?e(r):data.cwd)+n);else if("/"===i){var s=data.cwd.match(a);o=s?s[0]+n.substring(1):n}else o=data.base+n;return o}var r=/[^?#]*\//,o=/\/\.\//g,s=/\/[^/]+\/\.\.\//,c=/^\/\/.|:\//,a=/^.*?\/\/.*?\//;i.Path={dirname:e,realpath:t,resolve:n}}(),Date.prototype.format=function(e,t){e||(e="yyyy-MM-dd hh:mm:ss");var n={"M{2}":this.getMonth()+1,"d{2}":this.getDate(),"h{2}":this.getHours(),"m{2}":this.getMinutes(),"q{2}":Math.floor((this.getMonth()+3)/3)};t||(n["s{2}"]=this.getSeconds(),n["S{2}"]=this.getMilliseconds()),/(y{4}|y{2})/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in n)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?n[r]:("00"+n[r]).substr((""+n[r]).length)));return e};var f=$("head");i.Html={addLink:function(e){$('<link rel="stylesheet" type="text/css" href="'+e+'">').appendTo(f)},addScript:function(e,t,n){t?(document.write('<script src="'+e+'"></script>'),n&&n()):$("<script>").on("load",n).appendTo("body").attr("src",e)}};var l=function(){var e=localStorage,t="w_",n=function(e){return t+e},r={set:function(t,o){if(void 0===o||null===o)return r.rm(t);try{var i=JSON.stringify(o);return e.setItem(n(t),i),!0}catch(s){console.log(s)}},get:function(e,t){var r=localStorage[n(e)];if(void 0!=r&&null!=r){try{r=JSON.parse(r)}catch(o){console.log(o)}return r}return t},rm:function(t){t=n(t),t?e.removeItem(t):e.clear()},rmAll:function(){for(var n in e)0==n.indexOf(t)&&e.removeItem(n)}};return r}();i.Store=l,!function(){var e=function(e){return console.log("sysErr",e.stack),!1};process.on("uncaughtException",e),window.onerror=e}(),i.safe=function(e){try{e()}catch(t){console.log(t,t.stack)}};var g=c.App.manifest.window,d=function(){var t={};return function(r,o){var i=t[r];return i?(i.focus_flag=!0,i.focus()):(i=n(r),o&&(i.on("loaded",function(e){o.call(i,e)}),i.on("focus",function(){i.focus_flag&&(i.focus_flag=!1,o.call(i,e))})),i.on("beforeclose",function(){delete t[r],i.removeAllListeners(),i=null}),t[r]=i),i}}();i.Page={inited:function(e){u.emit("inited",e)},logout:function(e){l.rm("user_pwd");var t=n("login",e);return u.close(),t},main:function(e){return d("main",e)},addProduct:function(e){return d("m_addproduct",e)},confProduct:function(e){return d("m_confproduct",e)},setting:function(e){return d("m_setting",e)},textStyle:function(e){return d("m_text_style",e)}},i.Const=s.get("const"),i.Const.Event={GEOMAP_INITED:"0",PRODUCT_CHANGE:"1"};var p=$(document),h=[],v={get:function(){return u},getGui:function(){return c},close:function(){u.close()},onMessage:function(e,t){t&&v.offMessage(),-1==h.indexOf(e)&&(h.push(e),u.window.addEventListener("message",e))},offMessage:function(e){var t=[];if(e){t=e;var n=h.indexOf(onMessage);n>-1&&h.splice(n,1)}else t=h.splice();$.each(t,function(e,t){u.window.removeEventListener("message",t)})},sendMsg:function(e,t,n){n||(n=this),n.postMessage({type:e,data:t},location.origin)},onKeyEnter:function(e){p.off("keypress").on("keypress",function(t){13==t.which&&e&&e()})}};u.on("close",function(){this.hide(),v.offMessage(),this.close(!0)}),i.Window=v,!function(){function e(e){var t=Number(e).toString(16);return(1==t.length?"0":"")+t}function t(t){if(t){var n=r.exec(t);if(n)return"#"+e(n[1])+e(n[2])+e(n[3]);if(o.test(t))return t}}function n(e,t){if(e){var n=o.exec(e);if(n){var i=[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)];return t?i:"rgb("+i.join(",")+")"}var n=r.exec(e);if(n)return t?(n.shift(),n):e}}var r=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/,o=/#([\da-f]{2})([\da-f]{2})([\da-f]{2})/;i.Color={toRGB:n,toHTML:t}}(),i.util={isImg:function(e){return/\.(jpg|bmp|gif|png)$/i.test(e)}},!function(){var e={},t={log:function(){console.log.apply(console,arguments)}},n=["","# ","## "];t.Timer={start:function(t){e[t]=new Date},end:function(r,o){o=parseInt(o)||0,o>=0&&o<n.length||(o=0);var i=e[r];if(i){var s=new Date,c=s-i;return t.log(n[o]+""+r,"takes",c,"ms!"),delete e[r],c}}},i.util.Logger=t}(),t.Core=i}(this);