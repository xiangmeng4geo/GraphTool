(function(){var t,e,r,i,n,o,a,s,h,d,f;a=4,h=4,s=8,d=8,o=4,n=8,e=64,t=9007199254740992,f=function(t,e){return t+(e-t%e)%e},i=function(){function t(t){this.payload=t.header,this.payloadOffset=t.headerSize,this.readIndex=0,this.endIndex=t.getPayloadSize()}return t.prototype.readBool=function(){return 0!==this.readInt()},t.prototype.readInt=function(){return this.readBytes(a,Buffer.prototype.readInt32LE)},t.prototype.readUInt32=function(){return this.readBytes(h,Buffer.prototype.readUInt32LE)},t.prototype.readInt64=function(){return this.readBytes(s,Buffer.prototype.readInt64LE)},t.prototype.readUInt64=function(){return this.readBytes(d,Buffer.prototype.readUInt64LE)},t.prototype.readFloat=function(){return this.readBytes(o,Buffer.prototype.readFloatLE)},t.prototype.readDouble=function(){return this.readBytes(n,Buffer.prototype.readDoubleLE)},t.prototype.readString=function(){return this.readBytes(this.readInt()).toString()},t.prototype.readBytes=function(t,e){var r;return r=this.getReadPayloadOffsetAndAdvance(t),null!=e?e.call(this.payload,r,t):this.payload.slice(r,r+t)},t.prototype.getReadPayloadOffsetAndAdvance=function(t){var e;if(t>this.endIndex-this.readIndex)throw this.readIndex=this.endIndex,new Error("Failed to read data with length of "+t);return e=this.payloadOffset+this.readIndex,this.advance(t),e},t.prototype.advance=function(t){var e;return e=f(t,h),this.endIndex-this.readIndex<e?this.readIndex=this.endIndex:this.readIndex+=e},t}(),r=function(){function r(t){t?this.initFromBuffer(t):this.initEmpty()}return r.prototype.initEmpty=function(){return this.header=new Buffer(0),this.headerSize=h,this.capacityAfterHeader=0,this.writeOffset=0,this.resize(e),this.setPayloadSize(0)},r.prototype.initFromBuffer=function(e){return this.header=e,this.headerSize=e.length-this.getPayloadSize(),this.capacityAfterHeader=t,this.writeOffset=0,this.headerSize>e.length&&(this.headerSize=0),this.headerSize!==f(this.headerSize,h)&&(this.headerSize=0),0===this.headerSize?this.header=new Buffer(0):void 0},r.prototype.createIterator=function(){return new i(this)},r.prototype.toBuffer=function(){return this.header.slice(0,this.headerSize+this.getPayloadSize())},r.prototype.writeBool=function(t){return this.writeInt(t?1:0)},r.prototype.writeInt=function(t){return this.writeBytes(t,a,Buffer.prototype.writeInt32LE)},r.prototype.writeUInt32=function(t){return this.writeBytes(t,h,Buffer.prototype.writeUInt32LE)},r.prototype.writeInt64=function(t){return this.writeBytes(t,s,Buffer.prototype.writeInt64LE)},r.prototype.writeUInt64=function(t){return this.writeBytes(t,d,Buffer.prototype.writeUInt64LE)},r.prototype.writeFloat=function(t){return this.writeBytes(t,o,Buffer.prototype.writeFloatLE)},r.prototype.writeDouble=function(t){return this.writeBytes(t,n,Buffer.prototype.writeDoubleLE)},r.prototype.writeString=function(t){return this.writeInt(t.length)?this.writeBytes(t,t.length):!1},r.prototype.setPayloadSize=function(t){return this.header.writeUInt32LE(t,0)},r.prototype.getPayloadSize=function(){return this.header.readUInt32LE(0)},r.prototype.writeBytes=function(t,e,r){var i,n,o;return i=f(e,h),o=this.writeOffset+i,o>this.capacityAfterHeader&&this.resize(Math.max(2*this.capacityAfterHeader,o)),null!=r?r.call(this.header,t,this.headerSize+this.writeOffset):this.header.write(t,this.headerSize+this.writeOffset,e),n=this.headerSize+this.writeOffset+e,this.header.fill(0,n,n+i-e),this.setPayloadSize(o),this.writeOffset=o,!0},r.prototype.resize=function(t){return t=f(t,e),this.header=Buffer.concat([this.header,new Buffer(t)]),this.capacityAfterHeader=t},r}(),module.exports=r}).call(this);