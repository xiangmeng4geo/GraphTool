(function(){var e,r,t,i;t=require("fs"),i=require("path"),r=require("./cuint").UINT64,e=function(){function e(e){this.src=i.resolve(e),this.header={files:{}},this.offset=r(0)}return e.prototype.searchNodeFromDirectory=function(e){var r,t,o,s,n;for(o=this.header,t=e.split(i.sep),s=0,n=t.length;n>s;s++)r=t[s],"."!==r&&(o=o.files[r]);return o},e.prototype.searchNodeFromPath=function(e){var r,t,o;return(e=i.relative(this.src,e))?(r=i.basename(e),t=this.searchNodeFromDirectory(i.dirname(e)),null==t.files&&(t.files={}),null==(o=t.files)[r]&&(o[r]={}),t.files[r]):this.header},e.prototype.insertDirectory=function(e,r){var t;return t=this.searchNodeFromPath(e),r&&(t.unpacked=r),t.files={}},e.prototype.insertFile=function(e,t,o){var s,n;if(s=this.searchNodeFromPath(i.dirname(e)),n=this.searchNodeFromPath(e),t||s.unpacked)return n.size=o.size,void(n.unpacked=!0);if(o.size>4294967295)throw new Error(""+e+": file size can not be larger than 4.2GB");return n.size=o.size,n.offset=this.offset.toString(),"win32"!==process.platform&&64&o.mode&&(n.executable=!0),this.offset.add(r(o.size))},e.prototype.insertLink=function(e){var r,o;if(r=i.relative(t.realpathSync(this.src),t.realpathSync(e)),".."===r.substr(0,2))throw new Error(""+e+": file links out of the package");return o=this.searchNodeFromPath(e),o.link=r},e.prototype.listFiles=function(){var e,r;return e=[],r=function(t,o){var s,n,a;if(o.files){a=[];for(s in o.files)n=i.join(t,s),e.push(n),a.push(r(n,o.files[s]));return a}},r("/",this.header),e},e.prototype.getNode=function(e){var r,t;return t=this.searchNodeFromDirectory(i.dirname(e)),r=i.basename(e),r?t.files[r]:t},e.prototype.getFile=function(e,r){var t;return null==r&&(r=!0),t=this.getNode(e),t.link&&r?this.getFile(t.link):t},e}(),module.exports=e}).call(this);