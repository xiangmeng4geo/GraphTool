!function(){var n=require("./util");n.init({name:"import",width:600,height:500},function(){function i(n,i){try{f.write(n,JSON.stringify(i))}catch(e){}return!0}function e(n,i){i?T.val(n||""):(0!==n.indexOf("(")&&(n="    "+n),T.val(T.val()+"\n"+n),T.scrollTop(T.get(0).scrollHeight),console.log(n))}function r(n,i){try{var e=c.resolve(v,n);return delete require.cache[e],require(e)}catch(r){console.log(r)}return i}function t(n){function t(n){n.forEach(function(n){var i=n.childNodes;i?t(i):u.push(n.name)})}function o(){var t=u.shift();if(!t)return void(n&&n());e("\u5904\u7406 "+t);var a=r(t);if(a){try{a.data.val.dir_in=_}catch(s){}try{var v=a.data.val.file_rule.val_custom;f.copy(c.join(h,v),c.join(_,v)),e("\u590d\u5236 "+v)}catch(s){}try{var d=t+".json";i(c.join(l,d),a)&&e("\u5199\u5165 "+d)}catch(s){}}setTimeout(o,10)}var a=r(".tree",[]);i(c.join(l,".sys","sys_product_tree.json"),a)&&e("\u4ea7\u54c1\u5217\u8868\u5bfc\u51fa\u5b8c\u6210\uff01");var u=[];t(a),o()}function o(){var n=r(g,{}),t=r(".legend",[]);n.legend=t,i(g,n)&&e("\u56fe\u4f8b\u5bfc\u51fa\u5b8c\u6210\uff01")}function a(n){function t(){var r=u.shift();if(!r)return i(g,o)&&e("\u5730\u56fe\u5bfc\u51fa\u5b8c\u6210\uff01"),void(n&&n());var a=r.file,s=r.namenew;f.copy(c.join(d,a),s),e("\u590d\u5236 "+a),setTimeout(t,10)}var o=r(g,{}),a=r(".maps",[]),u=[],s={};a.forEach(function(n){var i=n.maps;i.forEach(function(n){var i=n.file,e=c.join(A,i);s[i]=e,n.file=e})});for(var l in s)u.push({file:l,namenew:s[l]});o.geo=a,t()}var c=(require("fs"),require("path")),u=require("./lib/j"),f=n.file,s=n.CONST,l=s.PATH_CONFIG_USER,v=(s.PATH_DATA,s.PATH_DATA_CONFIG),h=s.PATH_DATA_DATA,d=s.PATH_DATA_GEOFILE,_=c.join(c.dirname(l),"testdata"),A=c.join(c.dirname(l),"geo");process.on("uncaughtException",function(){var i="\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458!";e(i),n.ui.dialog.alert(i)});var T=u("textarea"),g=c.join(l,".sys","sys.json"),j=!1;u("#btn_yes").click(function(){if(!j){j=!0,e("",!0);var n=1;if(e("("+n++ +") \u6b63\u5728\u5907\u4efd\u65e7\u914d\u7f6e\u6587\u4ef6"),f.exists(l)){var i="config_bak_"+(new Date).getTime();f.copyDir(l,c.join(c.dirname(l),i)),e("\u539f\u6570\u636e\u5907\u4efd\u5728["+i+"]\u4e0b")}e("("+n++ +") \u6b63\u5728\u5bfc\u51fa\u4ea7\u54c1\u914d\u7f6e"),t(function(){e("("+n++ +") \u6b63\u5728\u5bfc\u51fa\u5730\u56fe\u914d\u7f6e"),a(function(){e("("+n++ +") \u6b63\u5728\u5bfc\u51fa\u56fe\u4f8b\u914d\u7f6e"),o(),e("----------------\u6210\u529f\u5bfc\u5165\uff01--------------"),j=!1})})}})})}();