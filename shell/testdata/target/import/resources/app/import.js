!function(){var i=require("./util");i.init({name:"import",width:600,height:500},function(){function n(i,n){n?g.val(i||""):(0!==i.indexOf("(")&&(i="    "+i),g.val(g.val()+"\n"+i),g.scrollTop(g.get(0).scrollHeight),console.log(i))}function e(i,n){try{var e=a.resolve(l,i);return delete require.cache[e],require(e)}catch(r){console.log(r)}return n}function r(i){function r(i){i.forEach(function(i){var n=i.childNodes;n?r(n):c.push(i.name)})}function t(){var r=c.shift();if(console.log(r,c),!r)return void(i&&i());n("\u5904\u7406 "+r);var o=e(r);if(o){try{o.data.val.dir_in=d}catch(s){}try{var l=o.data.val.file_rule.val_custom;f.copy(a.join(v,l),a.join(d,l)),n("\u590d\u5236 "+l)}catch(s){}try{var h=r+".json";f.write(a.join(u,h),JSON.stringify(o)),n("\u5199\u5165 "+h)}catch(s){}}setTimeout(t,10)}var o=e(".tree",[]);f.write(a.join(u,".sys","sys_product_tree.json"),JSON.stringify(o)),n("\u4ea7\u54c1\u5217\u8868\u5bfc\u51fa\u5b8c\u6210\uff01");var c=[];r(o),t()}function t(){var i=e(y,{}),r=e(".legend",[]);i.legend=r,f.write(y,JSON.stringify(i)),n("\u56fe\u4f8b\u5bfc\u51fa\u5b8c\u6210\uff01")}function o(i){function r(){var e=c.shift();if(!e)return f.write(y,JSON.stringify(t)),n("\u5730\u56fe\u5bfc\u51fa\u5b8c\u6210\uff01"),void(i&&i());var o=e.file,s=e.namenew;f.copy(a.join(h,o),s),n("\u590d\u5236 "+o),setTimeout(r,10)}var t=e(y,{}),o=e(".maps",[]),c=[],s={};o.forEach(function(i){var n=i.maps;n.forEach(function(i){var n=i.file,e=a.join(_,n);s[n]=e,i.file=e})});for(var u in s)c.push({file:u,namenew:s[u]});t.geo=o,r()}var a=(require("fs"),require("path")),c=require("./lib/j"),f=i.file,s=i.CONST,u=s.PATH_CONFIG_USER,l=(s.PATH_DATA,s.PATH_DATA_CONFIG),v=s.PATH_DATA_DATA,h=s.PATH_DATA_GEOFILE,d=a.join(a.dirname(u),"testdata"),_=a.join(a.dirname(u),"geo"),g=c("textarea"),y=a.join(u,".sys","sys.json"),A=!1;c("#btn_yes").click(function(){if(!A){A=!0,n("",!0);var i=1;if(n("("+i++ +") \u6b63\u5728\u5907\u4efd\u65e7\u914d\u7f6e\u6587\u4ef6"),f.exists(u)){var e="config_bak_"+(new Date).getTime();f.copyDir(u,a.join(a.dirname(u),e)),n("\u539f\u6570\u636e\u5907\u4efd\u5728["+e+"]\u4e0b")}n("("+i++ +") \u6b63\u5728\u5bfc\u51fa\u4ea7\u54c1\u914d\u7f6e"),r(function(){n("("+i++ +") \u6b63\u5728\u5bfc\u51fa\u5730\u56fe\u914d\u7f6e"),o(function(){n("("+i++ +") \u6b63\u5728\u5bfc\u51fa\u56fe\u4f8b\u914d\u7f6e"),t(),n("----------------\u6210\u529f\u5bfc\u5165\uff01--------------"),A=!1})})}})})}();