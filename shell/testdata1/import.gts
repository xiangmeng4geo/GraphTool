var fs=require("fs"),path=require("path"),os=require("os"),util=require("./util.gts"),dir_current=__dirname,dir_core=path.join(dir_current,"../../core");fs.existsSync(dir_core)||(dir_core=path.join(dir_current,"../../"));var dir_config=path.join(dir_core,"config"),dir_data=path.join(dir_current,"data"),dir_tmp=path.join(os.tmpdir()||os.tmpDir(),"gt_testdata");util.mkdirSync(dir_config),util.mkdirSync(dir_tmp),fs.readdir(dir_data,function(r,i){r?console.log(r):i&&i.length>0?(i.forEach(function(r){var i=path.join(dir_data,r),t=fs.readdirSync(i),n=[],o=[];t.forEach(function(r){var t=r;if(r=path.join(i,r),"sys_product_tree.json"==t)return void n.push({p:r,is_sys:!0});if(".json"==path.extname(r)&&0!=t.indexOf("___")){var a=require(r);if(a.file&&a.in_out)return void n.push({p:r,conf:a})}o.push({p:r})}),o.forEach(function(i,t){var n=path.join(dir_tmp,r);util.mkdirSync(n);var a=path.join(n,path.basename(i.p).replace("___",""));o[t].toP=a,util.copySync(i.p,a)}),n.forEach(function(r){var i=path.join(dir_config,path.basename(r.p));if(r.is_sys)return util.copySync(r.p,i);for(var t=r.conf,n=t.in_out.file_rule.custom,a="",e=0,c=o.length;c>e;e++)if(path.basename(o[e].p).replace("___","")==n){a=path.dirname(o[e].toP);break}a&&(t.in_out.dir_in=a,fs.writeFileSync(i,JSON.stringify(t)))})}),console.log("导入数据完成！")):console.log("没有要处理的配置文件！")});